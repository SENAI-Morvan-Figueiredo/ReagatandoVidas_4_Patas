{% extends "ong/base_admin.html" %}
{% load static %}
{% block title %}Gerenciar Adoções{% endblock %}

{% block content%}

<link rel="stylesheet" href="{% static 'css/dashboard_admin_adocoes.css' %}">

<div class="container py-4"> <!-- Caixa branca englobando tudo -->
    <div class="p-4 bg-white shadow-sm rounded-4"> <!-- Título e botão -->
        <div class="d-flex justify-content-between align-items-center mb-3 border-bottom pb-2">
            <div>
                <h2 class="fw-bold text-primary">Gerenciar Adoções</h2>
                <p class="subtitle-custom mb-0">Adicione, edite ou remova gatos para Adoção</p>
            </div> <a href="" class="btn btn-danger fw-bold shadow-sm rounded-3"> + Adicionar Gato </a>
        </div> <!-- Barra de pesquisa e filtros -->
        <form method="GET" action="">
            <div class="row justify-content-center mb-4">
                <div class="col-md-2 col-sm-4 mb-2"> <input type="text" name="nome"
                        class="form-control form-control-sm search-input" placeholder="Nome do Gato"
                        onkeyup="debounceSubmit(this.form, 600)" value="{{ request.GET.nome|default:'' }}">
                </div>
                <div class="col-md-2 col-sm-4 mb-2"> <select name="sexo" class="form-select form-select-sm search-input"
                        onchange="this.form.submit()">
                        <option value="">Todos os sexos</option>
                        <option value="M" {% if request.GET.sexo == "M" %}selected{% endif %}>Macho</option>
                        <option value="F" {% if request.GET.sexo == "F" %}selected{% endif %}>Fêmea</option>
                    </select> </div>
            </div>
        </form> <!-- Grid de Cards -->
        <div class="row g-4">
            {% for gato in gatos %}
            <div class="col-lg-3 col-md-4 col-sm-6">
                <div class="card border-0 h-100 rounded-4 overflow-hidden">
                    {% if gato.imagem %}
                    <img src="{{ gato.imagem.url }}" class="card-img-top" alt="{{ gato.nome }}"
                        style="object-fit: cover; height: 200px;"> {% else %} <img
                        src="https://placehold.co/300x200?text=Sem+Foto" class="card-img-top" alt="Sem imagem">
                    {%endif%}
                    <div class="card-body d-flex flex-column"> <!-- Nome e ícones de ação -->
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <h5 class="card-title mb-0">{{ gato.nome }}</h5>
                            <div class="d-flex gap-1"> <a href="" class="btn btn-light p-1" title="Editar"> <img
                                        src="{% static 'img/Icone_Editar.svg' %}" alt="Editar"
                                        style="width: 35px; height: 35px;"> </a> <a href="" class="btn btn-light p-1"
                                    title="Excluir"> <img src="{% static 'img/Icone_Excluir.svg' %}" alt="Excluir"
                                        style="width: 35px; height: 35px;"> </a> </div>

                        </div> <!-- Idade e sexo -->
                        <p class="card-text mb-2"> {{ gato.idade }} |
                            {% if gato.sexo == 'M' %}
                            Macho
                            {% else %}
                            Fêmea
                            {% endif %}
                        </p>
                    </div>
                </div>
            </div>
            {% empty %}
            <p class="text-muted">Nenhum gato cadastrado para adoção.</p>
            {% endfor %}
        </div>
    </div>
</div>

<script>
    let debounceTimer;

    function debounceSubmit(form, delay) {
        clearTimeout(debounceTimer); // reseta o timer se ainda estiver contando
        debounceTimer = setTimeout(() => {
            form.submit(); // envia o form só depois do delay
        }, delay);
    }
</script>

{% endblock %}